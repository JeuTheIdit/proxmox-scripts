#cloud-config
groups:
  - sudo

users:
  - name: jnbolsen
    gecos: Administrative user
    groups: sudo
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    lock_passwd: true
    ssh_authorized_keys:
      - ssh-ed25519 AAAA_YOUR_PUBLIC_KEY_HERE
  - name: ansible
    gecos: Ansible automation user
    groups: sudo
    sudo: ALL=(ALL) NOPASSWD:ALL
    shell: /bin/bash
    lock_passwd: true
    ssh_authorized_keys:
      - ssh-ed25519 AAAA_YOUR_PUBLIC_KEY_HERE

disable_root: true

package_update: true
package_upgrade: true

packages:
  - qemu-guest-agent

write_files:
  - path: /etc/ssh/sshd_config.d/99-hardening.conf
    content: |
      PermitRootLogin no
      PasswordAuthentication no
      PubkeyAuthentication yes
      ChallengeResponseAuthentication no
      UsePAM yes
      X11Forwarding no
      AllowTcpForwarding no
      AllowAgentForwarding no

runcmd:
  - systemctl restart systemd-networkd
  - systemctl enable --now qemu-guest-agent
  - systemctl restart ssh

final_message: "Debian 13 Cloud-Init base template ready."
